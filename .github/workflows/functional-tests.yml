---
name: Functional Tests

on:
  push:
    branches:
      - 'main'
  pull_request:

jobs:
  translate:
    run-name: Translate (${{ matrix.provider }})
    name: Translate
    timeout-minutes: 5
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - provider: linguatools
            lang: 'en-de'
            source: Love
            expected: Liebe
            api_key: N_A # pragma: allowlist secret
          - provider: mymemory
            lang: 'en|dk'
            source: Love
            expected: elskov
            api_key: N_A # pragma: allowlist secret
          - provider: mymemory
            lang: 'en|kr'
            source: Love
            expected: 사랑
            api_key: MYMEMORY_API_KEY # pragma: allowlist secret
          - provider: funtranslations
            lang: 'klingon'
            source: Love
            expected: Parmaq
            api_key: N_A # pragma: allowlist secret
      fail-fast: false
    steps:
      - uses: actions/checkout@v3
      - uses: ./
        id: result
        with:
          provider: linguatools
          lang: 'en-de'
          source: ${{ matrix.source }}
          api_key: ${{ secrets[matrix.api_key] }}
      - name: Validate ${{ matrix.provider }} translation result
        run: |
          echo "'${{ matrix.source }}' has been translated to '${{ steps.result.outputs.text }}'"
          [ "${{ steps.result.outputs.text }}" = "${{ matrix.expected }}" ] || exit 1;
        shell: sh
